<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Articles</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background-color: #f9fafb;
      font-family: "Inter", sans-serif;
    }
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 40px 0 20px;
    }
    .btn-create {
      background-color: #4f46e5;
      color: #fff;
      border-radius: 8px;
      padding: 8px 16px;
      font-weight: 600;
      text-decoration: none;
    }
    .btn-create:hover {
      background-color: #4338ca;
      color: #fff;
    }
    .table th {
      color: #475569;
      font-weight: 600;
      background-color: #f1f5f9;
    }
    .table td img {
      border-radius: 6px;
      width: 60px;
      height: 40px;
      object-fit: cover;
    }
    .badge-category {
      background-color: #eef2ff;
      color: #4f46e5;
      font-weight: 500;
      border-radius: 10px;
      padding: 4px 8px;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="page-header">
    <div>
      <h3 class="fw-bold text-primary mb-0">My Articles</h3>
      <p class="text-muted">Create and manage your articles</p>
    </div>
    <a href="create-article.html" class="btn-create">
      <i class="bi bi-plus-lg me-1"></i> Create Article
    </a>
  </div>

  <!-- Search -->
  <div class="mb-3">
    <input type="text" id="searchInput" class="form-control" placeholder="Search article...">
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Thumbnail</th>
              <th>Title</th>
              <th>Category</th>
              <th>Created At</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody id="articlesTableBody">
            <tr><td colspan="5" class="text-center text-muted">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav>
        <ul class="pagination justify-content-end" id="pagination"></ul>
      </nav>
    </div>
  </div>
</div>

<script>
const API = "http://blogs.csm.linkpc.net/api/v1";
const getToken = localStorage.getItem("authToken");

let articles = [];
let currentPage = 1;
const perPage = 5;

// Fetch articles from API
function fetchArticles() {
  fetch(`${API}/articles?_page=1&_per_page=50`, {
    method: "GET",
    headers: { "Authorization": `Bearer ${getToken}` }
  })
  .then(res => res.json())
  .then(data => {
    articles = data.data.items;
    renderTable();
    renderPagination();
  })
  .catch(err => {
    console.error("Error fetching articles:", err);
    document.getElementById("articlesTableBody").innerHTML = `
      <tr><td colspan="5" class="text-center text-danger">Failed to load articles.</td></tr>
    `;
  });
}

// Render table based on current page & search filter
function renderTable() {
  const tbody = document.getElementById("articlesTableBody");
  const searchQuery = document.getElementById("searchInput").value.toLowerCase();

  const filtered = articles.filter(article =>
    article.title.toLowerCase().includes(searchQuery)
  );

  const start = (currentPage - 1) * perPage;
  const paginated = filtered.slice(start, start + perPage);

  tbody.innerHTML = paginated.length ? "" : `
    <tr><td colspan="5" class="text-center text-muted">No articles found.</td></tr>
  `;

  paginated.forEach(article => {
    const createdAt = new Date(article.createdAt).toLocaleString("en-US", {
      day: "2-digit", month: "short", year: "numeric",
      hour: "2-digit", minute: "2-digit"
    });
    const categoryName = article.category ? article.category.name : "â€”";
    const thumbnailUrl = article.thumbnail || "https://via.placeholder.com/60x40?text=No+Image";

    tbody.innerHTML += `
      <tr>
        <td><img src="${thumbnailUrl}" alt="Thumbnail"></td>
        <td>${article.title}</td>
        <td><span class="badge-category">${categoryName}</span></td>
        <td>${createdAt}</td>
        <td class="text-end">
          <button class="btn btn-sm btn-outline-secondary me-1"><i class="bi bi-pencil"></i></button>
          <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
        </td>
      </tr>
    `;
  });
}

// Render pagination controls
function renderPagination() {
  const searchQuery = document.getElementById("searchInput").value.toLowerCase();
  const filtered = articles.filter(article =>
    article.title.toLowerCase().includes(searchQuery)
  );

  const totalPages = Math.ceil(filtered.length / perPage);
  const pagination = document.getElementById("pagination");

  pagination.innerHTML = "";

  for (let i = 1; i <= totalPages; i++) {
    const active = i === currentPage ? "active" : "";
    pagination.innerHTML += `
      <li class="page-item ${active}">
        <a class="page-link" href="#">${i}</a>
      </li>
    `;
  }

  // Add click event
  document.querySelectorAll("#pagination .page-link").forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      currentPage = Number(link.textContent);
      renderTable();
      renderPagination();
    });
  });
}

// Search input
document.getElementById("searchInput").addEventListener("input", () => {
  currentPage = 1;
  renderTable();
  renderPagination();
});

fetchArticles();
</script>

</body>
</html>
